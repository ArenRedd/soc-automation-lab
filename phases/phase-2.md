This is part two of the sock automation project update. Today's video is all about configuring Waza and the Hive. Let's get started. All right, to begin, we'll be configuring the Hive first. So, first and foremost, let's go ahead and configure our Cassandra, which is located under /c/cassandra/cassandra. A ml aka YAML. What we want to do here is change the cluster name. Currently it is set to test cluster. I'm just going to change this to my epher. And then from here we want to change our listening address. What we can do is hold controll and then type in listen. This will go and search for the word listen and then we can see right here we have listen address listed as localhost. Now I am going to remove this and I am going to put in the IP address of our Hive instance and since I do not remember the IP address I'll go over to my vulture and let's click on back here. So the IP address is this right here 155.138. I'll just copy this and let's paste that in. The next thing we want to do is hold control W again and we'll look for RPC. We scroll down. We could eventually find this right here. RPC address. So I'll remove my local host and again replace it with our public IP address of the hive. Just rightclick to paste that in. And lastly, let's look for seed provider. Now we don't necessarily need to change this because it is only needed for those if you were to do like a distributed environment. For example, if you happen to utilize more than one Cassandra node, this is essentially how it will find the main one if that makes sense. But anyways, I'm just going to remove this and then replace it with my public IP. Finally, we can go ahead and save it by holding Ctrl X, Y to save, and enter. Next thing to do is go ahead and stop the service. So, I'll type in systemctl stop Cassandra, hit tab for autocomp completion, and enter. And then we'll remove any of the remaining files under var lib cassandra. And I'll put in an asterisk for everything. Now we'll go ahead and type in systemct ctl start cassandra. And we can check the status of it. Now just like that. And we currently see it as active and running. The next thing to do here is to configure our elastic search. To do that I'll be using nano. and we'll point it over to /etc elastic search and elastic search.yiml. Now we see a hey this directory does not exist. Interesting. Well, let's see if I mistyped it by accident. I can type in nano/etc. And if I type in elastic and then hit tab for autocomp completion, I don't get anything. So it is indeed that I don't have elastic search. What that tells me is that in the previous video when I was installing Elastic Search, something went wrong there. So, let's go back over to the Hive and let's take a look. So, I'll go ahead and rerun everything from step number one for Elastic Search. Copy that. Paste that in here. And it did ask me for a new file name, but I just went ahead and hit enter. And it said it failed because hey, file exists. So, that's good. We know for a fact that this particular command worked. Now, let's do this one here. Hit enter. Now, we can type in apt update. And finally, apt install elastic search. But just to make sure, I'm going to go back over to the hive. And we do see it here. Apt install elastic search. Enter. And there you go. It is slowly but surely installing elastic. Great. Now that that's done, clear out the screen. Let's try this one more time. I'll type in nano/etc elastic and let's hit tab. There you go. It's right here. Type in elastic search dot. Hit tab again. And we see the file YML. I'll scroll all the way down until we get to the cluster name. Go ahead and remove that to uncomment it. And by default, it is set to my application, but I'm going to remove this and type in my DFIR. Under the node name, I'm going to remove this comment as well, but I'll leave this as node- one. Scrolling down, eventually we get hit with this network host. Let's go ahead and remove the comment. And we'll paste in the public IP of our Hive, which again is this right here, 155138147242. And yours is going to be different. I'll uncomment the http.port. And for the cluster, let's go ahead and uncomment that. I'll remove node two and just leave node one. Now we can go ahead and hold crl x and save it out. Type in systemct ctl start elastic search. Type in systemct ctl enable elastic search. And finally let's check out the status of elastic search. And it is currently running. The next thing to do is start configuring the hive. Before we proceed, we do need to change some permissions for a particular directory. The one that we're interested in is the /opt/THP directory. Now, if I go into it, so cd/opt. If I type in ll, we can see that currently the hive, well, the hive directory is currently owned by root and root. We need to change this. So the owner and the group is actually the hive and I'll point it over to /opth. So this will change the permissions for this particular folder THP and with the dash capital R it will also change the hive directory within THP. If I hit enter now if I type in ll we can see that the user and the group is now changed to the hive. Now that we're done that, we can start configuring the Hive. I'll type in nano and we'll want to head over to /c/thehive slapplication.com. Now, if we scroll down, we do see a host name calling out to 127.0.0.1 aka localhost. So, I'm going to change this and we'll paste in our public IP address. For the cluster name, it is my DFIR. And under the elastic search, we'll remove the local host IP address. Paste in our public IP. And I believe that is it. Nope, I am a liar. So under application base URL, I'm going to change localhost, paste in my IP address. Now I believe we are good. Let's go ahead and hold X Y to save and enter. Type in systemctl start the hive and then systemctl enable the hive. And finally, let's check out the status of the hive. And that is currently active and running. Just as a sanity check, I'm going to check out the status of Cassandra that is active and running as well. And the status of elastic search and that is also running. What that means in theory is that I should be able to access the Hive without any issues. So, how do we access it? Well, if we go back over to the Hive here, and if we scroll all the way down, it'll tell us that after the service has successfully started, we can launch a web browser and navigate to our public IP address or the address of the Hive on port 9,000. All right, let's do that. http paste in our public IP on port 9,000. Now, this looks like it's not going to work, and that is likely because of our firewall. Back over to my SSH session within the Hive. Cleared the screen. I'm going to type in UFW allow 9,000. Now, let's go back over to our web browser. And there you go. We now see the Hive. So, what is the username and password? Well, back to our step-by-step guide, we do see the username, which is adminive.local, local and the password of secret. I'm going to copy that and put in secret as the password. And there you go. As I mentioned previously, the main difference from the previous sock automation is that the hive was essentially using a free community edition. So you could use it for as long as you want. But now the hive switched over to a more commercial license. What that means for you again is that you have 14 or well in this case 15 days to complete the project. But with Hive up and running and we've successfully logged into it, we can confirm that the Hive is pretty much configured and ready to go. The next thing that we got to do is start configuring Wazal and get our Windows 11 agent to call in to Wazal so we can start generating some malicious telemetry. Now, I wanted to pause here for a second and let you know that if you are interested in learning how to become a sock analyst, I have created a dedicated sock community. And inside of that, I have created what is called the 90day sock accelerator. Essentially, you commit to 90 days and you should come out with enough skills to become a great sock analyst. In addition to this, I have also created a sock simulator where you get to get hands-on experience with enterprise tooling such as Microsoft XDR and Microsoft Sentinel. So, if you ever wanted real hands-on experience to put onto your resume, this is it. You can learn more about this in the description down below. Let's get back to it. And right here is my Wiz dashboard. Over on the lefth hand side, we have a deploy new agent. So, this makes it super easy for us. Make sure you select the windows. So, this one right here. And the server address. This is going to be our public IP address for Wazot. And now that I'm thinking about this, let me do this on my Windows 11 virtual machine. So, this is it right here. I'm currently inside of the Windows 11 virtual machine. I'll type in HTTPS and the public IP address of my Waz server. And you know what? Let me just paste that in here. That way, I can see it. So, https137.220 220 53.146 and we'll click on advance continue. Now I don't really like working in such a small screen. So what I'll do here is I'll install what is called the guest editions. And what this will do is allow me to maximize my screen and provide me additional capabilities like copy and paste from my host machine into my virtual machine. Click on my CD drive and let's double click VBox Windows Editions. Click on next, next, next, and install. Already this is looking a lot nicer. Let's go ahead and reboot this. And now we should be able to change the display resolution. Yeah, there you go. It's a little better. And if we head over to devices, shared clipboard, let's do host to guest. All righty. Let's go back over to our wasah, which was http. There you go. And we can go ahead and type in admin and paste in the password. Now, you might be wondering, well, Stephen, why are you doing this inside of the Windows 11 virtual machine and not just what you were doing before? And that is because if I do it through the virtual machine, I can just easily install the agent directly on it. Make sure we select our Windows the server address. This again is our public IP. So 137.22053146. And we can assign the agent name. Might as well do that. My defer- Windows. And then we got to run the following commands to download and install the agent. So I'll copy that. Open up PowerShell, run as administrator, and then we'll paste that in here. Once that's good to go, type in net start was svc. And it says the waza service was started successfully. Now, if we go back over to our wasah manager here, and let's scroll up. Let's go into home overview. We should eventually start seeing our agent. Now, if we refresh this, we still don't see an agent after waiting a couple minutes. Now, if you're using Vulture like I am, by default, those virtual machines will have UFW up and running. So, that means we need to enable a couple of ports within UFW to allow our agent to communicate with our Waz manager. And I'll go back over to my SSH Waz session, which is this one right here. As you can tell by the host name of my defer-waz, the port that I need to allow is port 1515 and also 1514. Now, if we go back over to our Wazah manager and here I am connected on my host machine. So, I'm not in my virtual Windows 11 machine. I'm accessing my Waza through my host. Clicking on home overview. Still don't see an agent. Well, that's okay. Let's go into our Windows 11 virtual machine now and from here open up services. So if I click on any of them and type in W and here we can find our WA service. So go ahead and rightclick and restart. Now on our WA manager again let's go ahead and refresh the page. We can now see one active agent. So that confirms that our agent is now talking to our Wizaw manager.